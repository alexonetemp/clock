<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000">
  <title>7-Segment Clock</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: Arial, sans-serif;
      overflow: hidden;
      padding: 0;
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }

    body.fullscreen {
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    #clock-container {
      width: 100%;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
    }

    #clock {
      display: flex;
      gap: 2vw;
    }

    .digit {
      display: flex;
      flex-direction: column;
      gap: 0.3vw;
      position: relative;
      width: 20vw;
      height: 38vw;
    }

    .colon {
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      align-items: center;
      padding: 6vw 0;
      transition: opacity 0.3s;
    }

    .colon.hidden {
      opacity: 0;
    }

    .colon-dot {
      width: 4vw;
      height: 4vw;
      border-radius: 50%;
      transition: opacity 0.3s;
    }

    .colon.blink .colon-dot {
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.1; }
    }

    .segment {
      position: absolute;
      transition: opacity 0.3s;
    }

    .segment.h {
      width: 100%;
      height: 2.5vw;
      left: 0;
    }

    .segment.v {
      width: 2.5vw;
      height: 17vw;
    }

    .seg-a { top: 0; }
    .seg-b { top: 3vw; right: 0; }
    .seg-c { top: 21vw; right: 0; }
    .seg-d { bottom: 0; }
    .seg-e { top: 21vw; left: 0; }
    .seg-f { top: 3vw; left: 0; }
    .seg-g { top: 17.5vw; }

    /* Color themes */
    .color-red .segment,
    .color-red .colon-dot { background: #ff0000; }
    
    .color-green .segment,
    .color-green .colon-dot { background: #00ff00; }
    
    .color-blue .segment,
    .color-blue .colon-dot { background: #0099ff; }
    
    .color-amber .segment,
    .color-amber .colon-dot { background: #ffaa00; }
    
    .color-white .segment,
    .color-white .colon-dot { background: #ffffff; }
    
    .color-magenta .segment,
    .color-magenta .colon-dot { background: #ff00ff; }

    /* Brightness levels - 20 to 100 in steps */
    .brightness-20 .segment.on { opacity: 0.20; }
    .brightness-20 .segment:not(.on) { opacity: 0.02; }
    .brightness-20 .colon-dot { opacity: 0.20; }

    .brightness-30 .segment.on { opacity: 0.30; }
    .brightness-30 .segment:not(.on) { opacity: 0.03; }
    .brightness-30 .colon-dot { opacity: 0.30; }

    .brightness-40 .segment.on { opacity: 0.40; }
    .brightness-40 .segment:not(.on) { opacity: 0.04; }
    .brightness-40 .colon-dot { opacity: 0.40; }

    .brightness-50 .segment.on { opacity: 0.50; }
    .brightness-50 .segment:not(.on) { opacity: 0.05; }
    .brightness-50 .colon-dot { opacity: 0.50; }

    .brightness-60 .segment.on { opacity: 0.60; }
    .brightness-60 .segment:not(.on) { opacity: 0.06; }
    .brightness-60 .colon-dot { opacity: 0.60; }

    .brightness-70 .segment.on { opacity: 0.70; }
    .brightness-70 .segment:not(.on) { opacity: 0.07; }
    .brightness-70 .colon-dot { opacity: 0.70; }

    .brightness-80 .segment.on { opacity: 0.80; }
    .brightness-80 .segment:not(.on) { opacity: 0.08; }
    .brightness-80 .colon-dot { opacity: 0.80; }

    .brightness-90 .segment.on { opacity: 0.90; }
    .brightness-90 .segment:not(.on) { opacity: 0.09; }
    .brightness-90 .colon-dot { opacity: 0.90; }

    .brightness-100 .segment.on { opacity: 1.00; }
    .brightness-100 .segment:not(.on) { opacity: 0.10; }
    .brightness-100 .colon-dot { opacity: 1.00; }

    /* Margin classes */
    .margin-0 { margin: 0; }
    .margin-5 { margin: 5px; }
    .margin-10 { margin: 10px; }
    .margin-15 { margin: 15px; }
    .margin-20 { margin: 20px; }
    .margin-25 { margin: 25px; }
    .margin-30 { margin: 30px; }
    .margin-35 { margin: 35px; }
    .margin-40 { margin: 40px; }
    .margin-45 { margin: 45px; }
    .margin-50 { margin: 50px; }

    #message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      padding: 15px 25px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.5s;
      z-index: 1000;
      pointer-events: none;
    }

    #message.show {
      opacity: 1;
    }

    #settings {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(20, 20, 20, 0.95);
      color: #fff;
      padding: 20px;
      transform: translateY(100%);
      transition: transform 0.3s;
      z-index: 999;
    }

    #settings.show {
      transform: translateY(0);
    }

    .setting-group {
      margin-bottom: 20px;
    }

    .setting-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .color-picker {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .color-btn {
      width: 40px;
      height: 40px;
      border: 2px solid transparent;
      border-radius: 4px;
      cursor: pointer;
      transition: border-color 0.2s;
    }

    .color-btn.active {
      border-color: #fff;
    }

    .color-btn.red { background: #ff0000; }
    .color-btn.green { background: #00ff00; }
    .color-btn.blue { background: #0099ff; }
    .color-btn.amber { background: #ffaa00; }
    .color-btn.white { background: #ffffff; }
    .color-btn.magenta { background: #ff00ff; }

    input[type="range"] {
      width: 100%;
      height: 6px;
      background: #444;
      border-radius: 3px;
      outline: none;
    }

    input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    input[type="checkbox"]:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 998;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="message"></div>
  <div id="overlay"></div>
  
  <div id="clock-container">
    <div id="clock" class="color-red brightness-100 margin-0">
      <div class="digit" data-digit="0"></div>
      <div class="digit" data-digit="1"></div>
      <div class="colon blink">
        <div class="colon-dot"></div>
        <div class="colon-dot"></div>
      </div>
      <div class="digit" data-digit="2"></div>
      <div class="digit" data-digit="3"></div>
    </div>
  </div>

  <div id="settings">
    <div class="setting-group">
      <label>Color</label>
      <div class="color-picker">
        <div class="color-btn red active" data-color="red"></div>
        <div class="color-btn green" data-color="green"></div>
        <div class="color-btn blue" data-color="blue"></div>
        <div class="color-btn amber" data-color="amber"></div>
        <div class="color-btn white" data-color="white"></div>
        <div class="color-btn magenta" data-color="magenta"></div>
      </div>
    </div>

    <div class="setting-group">
      <label>Brightness</label>
      <input type="range" id="brightness" min="20" max="100" step="10" value="100">
    </div>

    <div class="setting-group">
      <label>Clock Padding (0-50px)</label>
      <input type="range" id="padding" min="0" max="50" step="5" value="0">
    </div>

    <div class="setting-group">
      <label class="checkbox-label">
        <input type="checkbox" id="fullscreen" checked>
        <span>Fullscreen mode</span>
      </label>
    </div>

    <div class="setting-group">
      <label class="checkbox-label">
        <input type="checkbox" id="showColon" checked>
        <span>Blink colon</span>
      </label>
    </div>

    <div class="setting-group">
      <label class="checkbox-label">
        <input type="checkbox" id="wakeLock" checked>
        <span id="wakeLockLabel">Keep screen on</span>
      </label>
    </div>
  </div>

  <script>
    const segmentMap = {
      0: ['a','b','c','d','e','f'],
      1: ['b','c'],
      2: ['a','b','d','e','g'],
      3: ['a','b','c','d','g'],
      4: ['b','c','f','g'],
      5: ['a','c','d','f','g'],
      6: ['a','c','d','e','f','g'],
      7: ['a','b','c'],
      8: ['a','b','c','d','e','f','g'],
      9: ['a','b','c','d','f','g']
    };

    let wakeLock = null;
    let wakeLockSupported = false;
    const clockEl = document.getElementById('clock');

    // Initialize digits
    function initDigits() {
      document.querySelectorAll('.digit').forEach(digitEl => {
        const segments = ['a','b','c','d','e','f','g'];
        segments.forEach(seg => {
          const segEl = document.createElement('div');
          segEl.className = `segment seg-${seg} ${seg === 'a' || seg === 'd' || seg === 'g' ? 'h' : 'v'}`;
          digitEl.appendChild(segEl);
        });
      });
    }

    // Update digit display
    function updateDigit(digitEl, num) {
      const activeSegs = segmentMap[num];
      digitEl.querySelectorAll('.segment').forEach(seg => {
        const segName = seg.classList[1].split('-')[1];
        seg.classList.toggle('on', activeSegs.includes(segName));
      });
    }

    // Update clock
    function updateClock() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const time = hours + minutes;

      document.querySelectorAll('.digit').forEach((digitEl, i) => {
        updateDigit(digitEl, parseInt(time[i]));
      });
    }

    // Apply color
    function applyColor(color) {
      clockEl.className = clockEl.className.replace(/color-\w+/, `color-${color}`);
    }

    // Apply brightness
    function applyBrightness(value) {
      clockEl.className = clockEl.className.replace(/brightness-\d+/, `brightness-${value}`);
    }

    // Apply margin
    function applyMargin(value) {
      clockEl.className = clockEl.className.replace(/margin-\d+/, `margin-${value}`);
    }

    // Show message
    function showMessage(text, duration = 3500) {
      const msg = document.getElementById('message');
      msg.textContent = text;
      msg.classList.add('show');
      setTimeout(() => msg.classList.remove('show'), duration);
    }

    // Wake Lock
    async function requestWakeLock() {
      if (!wakeLockSupported) return;
      try {
        wakeLock = await navigator.wakeLock.request('screen');
        wakeLock.addEventListener('release', () => {
          console.log('Wake Lock released');
        });
      } catch (err) {
        console.error('Wake Lock error:', err);
      }
    }

    function releaseWakeLock() {
      if (wakeLock) {
        wakeLock.release();
        wakeLock = null;
      }
    }

    // Check Wake Lock support
    async function initWakeLock() {
      wakeLockSupported = 'wakeLock' in navigator;
      const checkbox = document.getElementById('wakeLock');
      const label = document.getElementById('wakeLockLabel');

      if (wakeLockSupported) {
        showMessage('Screen Wake Lock enabled âœ“');
        await requestWakeLock();
      } else {
        showMessage('Screen Wake Lock not supported on this device');
        checkbox.checked = false;
        checkbox.disabled = true;
        label.textContent = 'Keep screen on (not supported)';
      }
    }

    // Settings toggle
    let settingsOpen = false;
    document.getElementById('overlay').addEventListener('click', () => {
      settingsOpen = !settingsOpen;
      document.getElementById('settings').classList.toggle('show', settingsOpen);
    });

    // Color picker
    document.querySelectorAll('.color-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        applyColor(btn.dataset.color);
      });
    });

    // Brightness
    document.getElementById('brightness').addEventListener('input', (e) => {
      applyBrightness(e.target.value);
    });

    // Padding
    document.getElementById('padding').addEventListener('input', (e) => {
      applyMargin(e.target.value);
    });

    // Show colon
    document.getElementById('showColon').addEventListener('change', (e) => {
      document.querySelector('.colon').classList.toggle('blink', e.target.checked);
    });

    // Fullscreen toggle
    document.getElementById('fullscreen').addEventListener('change', async (e) => {
      if (e.target.checked) {
        try {
          if (document.documentElement.requestFullscreen) {
            await document.documentElement.requestFullscreen();
          } else if (document.documentElement.webkitRequestFullscreen) {
            await document.documentElement.webkitRequestFullscreen();
          }
          document.body.classList.add('fullscreen');
        } catch (err) {
          console.log('Fullscreen not supported or denied');
        }
      } else {
        try {
          if (document.exitFullscreen) {
            await document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            await document.webkitExitFullscreen();
          }
          document.body.classList.remove('fullscreen');
        } catch (err) {
          console.log('Exit fullscreen error');
        }
      }
    });

    // Listen for fullscreen changes from user (ESC key, etc)
    document.addEventListener('fullscreenchange', () => {
      const isFullscreen = !!document.fullscreenElement;
      document.getElementById('fullscreen').checked = isFullscreen;
      document.body.classList.toggle('fullscreen', isFullscreen);
    });

    document.addEventListener('webkitfullscreenchange', () => {
      const isFullscreen = !!document.webkitFullscreenElement;
      document.getElementById('fullscreen').checked = isFullscreen;
      document.body.classList.toggle('fullscreen', isFullscreen);
    });

    // Wake Lock checkbox
    document.getElementById('wakeLock').addEventListener('change', async (e) => {
      if (e.target.checked) {
        await requestWakeLock();
      } else {
        releaseWakeLock();
      }
    });

    // Re-acquire wake lock on visibility change
    document.addEventListener('visibilitychange', async () => {
      if (document.visibilityState === 'visible' && wakeLockSupported && document.getElementById('wakeLock').checked) {
        await requestWakeLock();
      }
    });

    // Initialize
    initDigits();
    updateClock();
    setInterval(updateClock, 1000);
    initWakeLock();

    // Auto-enter fullscreen on load (mobile)
    window.addEventListener('load', async () => {
      if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
        // Running as PWA
        try {
          if (document.documentElement.requestFullscreen) {
            await document.documentElement.requestFullscreen();
          } else if (document.documentElement.webkitRequestFullscreen) {
            await document.documentElement.webkitRequestFullscreen();
          }
          document.body.classList.add('fullscreen');
        } catch (err) {
          console.log('Auto fullscreen not available');
        }
      }
    });
  </script>
</body>
</html>